# Cascade Analytics Scripts - Client Guide

## Overview
These Python scripts allow you to collect and analyze Cascade usage data, producing detailed reports on suggested vs. accepted lines of code, model usage, and tool usage per user.

## Required Setup
- **Service Key**: Create at https://windsurf.com/team/settings
  - Go to Service Key Configuration → Configure → Add service key
  - Use Role: admin OR create a custom role with read-only access:
    - https://windsurf.com/team/settings → Role Management → Configure → Create role
    - Grant the new role the "Analytics Read" permissions
- `.env` file with `SERVICE_KEY=your_key_here`
- **Dependencies**: Install required Python packages
  ```bash
  pip install requests python-dotenv pandas
  ```

## End-to-End Workflow
1. **Configure**: Add service key to the `.env` file
2. **Extract Emails** (Optional): Run `python3 -m AnalyticScripts.email_api_mapping` to automatically fetch user emails
   - Use `--start-date` and `--end-date` to customize the date range
3. **Collect**: Run `python3 CascadeLinesPerUser.py` with desired options
   - Use `--limit` or `--email` to filter which users to process
   - Use `--start-date` and `--end-date` to customize the date range
4. **Analyze**: Run `python3 generate_csv_reports.py`
5. **Visualize**: Import the CSVs into Excel, Tableau, or another analytics tool

## Scripts

### STEP 1: email_api_mapping.py (Optional)
**Email Extraction**

#### What it does:
- Connects to Codeium's UserPageAnalytics API using your service key
- Fetches all user data for the specified time period
- Extracts a list of unique email addresses and their associated API keys
- Saves them to `email_api_mapping_YYYY-MM-DD.json`

#### How to run:
```bash
# Default: Fetch emails from the last month
python3 -m AnalyticScripts.email_api_mapping

# Specify a custom date range
python3 -m AnalyticScripts.email_api_mapping --start-date 2025-08-01 --end-date 2025-09-01

# Specify a custom output file
python3 -m AnalyticScripts.email_api_mapping --output custom_emails.json
```

#### Command-line options:
- `--start-date`: Start date in YYYY-MM-DD format (default: 1 month ago)
- `--end-date`: End date in YYYY-MM-DD format (default: today)
- `--output`: Output JSON file name (default: email_api_mapping_YYYY-MM-DD.json)

### STEP 2: CascadeLinesPerUser.py
**API Data Collection**

#### What it does:
- Connects to Codeium's analytics API using your service key
- Processes email addresses from `unique_emails.json` (if available) or uses a default list
- Collects three types of data for each user:
  - **cascade_lines**: Suggested vs. accepted lines
  - **cascade_runs**: Model usage, messages sent, prompts used
  - **cascade_tool_usage**: Tool usage statistics (CODE_ACTION, VIEW_FILE, etc.)
- Saves all results to `cascade_analytics_results.json`

#### How to run:
```bash
# Default: Process all emails from the last month
python3 CascadeLinesPerUser.py

# Process only a limited number of emails (e.g., first 5)
python3 CascadeLinesPerUser.py --limit 5

# Process a specific email
python3 CascadeLinesPerUser.py --email user@example.com

# Specify a custom date range
python3 CascadeLinesPerUser.py --start-date 2025-08-01 --end-date 2025-09-01

# Specify a custom output file
python3 CascadeLinesPerUser.py --output custom_results.json
```

#### Command-line options:
- `--limit`: Limit the number of emails to process (0 for all emails)
- `--email`: Process a single specific email
- `--start-date`: Start date in YYYY-MM-DD format (default: 1 month ago)
- `--end-date`: End date in YYYY-MM-DD format (default: today)
- `--output`: Output JSON file name (default: cascade_analytics_results.json)

### STEP 3: generate_csv_reports.py
**CSV Report Generation**

#### What it does:
- Reads the JSON file generated by the previous script
- Creates three structured CSV reports:

##### 1. Daily Report (`daily_user_analytics_YYYYMMDD.csv`)
- One row per user/date
- Columns: email, date, accepted/suggested lines, acceptance %, models used, messages, prompts

##### 2. Aggregated Report (`aggregated_user_analytics_YYYYMMDD.csv`)
- One row per user with totals
- Columns: email, totals of lines/messages/prompts, plus one column for each Cascade tool

##### 3. Model Usage Report (`model_usage_analytics_YYYYMMDD.csv`)
- One row per user/date/model combination
- Columns: email, date, model, messagesSent, promptsUsed
- Useful for analyzing which models are most frequently used by each user

#### How to run:
```bash
python3 generate_csv_reports.py
```

## Output Files
- `email_api_mapping_YYYY-MM-DD.json` - Mapping of email addresses to API keys (from email_api_mapping.py)
- `cascade_analytics_results.json` - Raw API data
- `daily_user_analytics_YYYYMMDD.csv` - Daily report
- `aggregated_user_analytics_YYYYMMDD.csv` - Aggregated report
- `model_usage_analytics_YYYYMMDD.csv` - Model usage report

The CSV reports are ideal for analyzing usage patterns, user productivity, and adoption of Cascade tools.
